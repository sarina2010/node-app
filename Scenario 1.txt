do begin

DELETE FROM "PSURENDR"."SP_CE1TMED";

INSERT INTO "PSURENDR"."SP_CE1TMED" (
  MATNR, KAUFN, KDPOS, BUKRS, REC_WAERS, STDPR, KWSKTO, KWKDRB, VVREF, VVFEE, VV030, KWFRGR, VVREB, VKORG, KWBRUM, KWSVME,
  MAKTX_MATNR, BUTXT,
  CC_COGS,
  CC_CASH_DISCOUNT,
  CC_CUSTOMER_DISCOUNT,
  CC_GPO_FEES,
  CC_OTHER_FEES,
  CC_SERVICE_REVENUE,
  CC_FREIGHT_REVENUE,
  CC_REBATE_FEES,
  VBAK_ERDAT,
  VBAK_AUART,
  VBAP_PSTYV,
  VBAP_VRKME,
  VBAP_MEINS,
  PERIO
)
SELECT
  CE1TMED.MATNR,
  CE1TMED.KAUFN,
  CE1TMED.KDPOS,
  CE1TMED.BUKRS,
  CE1TMED.REC_WAERS,
  CE1TMED.STDPR,
  CE1TMED.KWSKTO,
  CE1TMED.KWKDRB,
  CE1TMED.VVREF,
  CE1TMED.VVFEE,
  CE1TMED.VV030,
  CE1TMED.KWFRGR,
  CE1TMED.VVREB,
  CE1TMED.VKORG,
  CE1TMED.KWBRUM,
  CE1TMED.KWSVME,
  MAKT.MAKTX AS MAKTX_MATNR,
  T001.BUTXT,
  CASE WHEN TCURX.CURRDEC IS NULL THEN CE1TMED.STDPR ELSE CE1TMED.STDPR * 100.00 END AS CC_COGS,
  CASE WHEN TCURX.CURRDEC IS NULL THEN CE1TMED.KWSKTO ELSE CE1TMED.KWSKTO * 100.00 END AS CC_CASH_DISCOUNT,
  CASE WHEN TCURX.CURRDEC IS NULL THEN CE1TMED.KWKDRB ELSE CE1TMED.KWKDRB * 100.00 END AS CC_CUSTOMER_DISCOUNT,
  CASE WHEN TCURX.CURRDEC IS NULL THEN CE1TMED.VVREF ELSE CE1TMED.VVREF * 100.00 END AS CC_GPO_FEES,
  CASE WHEN TCURX.CURRDEC IS NULL THEN CE1TMED.VVFEE ELSE CE1TMED.VVFEE * 100.00 END AS CC_OTHER_FEES,
  CASE WHEN TCURX.CURRDEC IS NULL THEN CE1TMED.VV030 ELSE CE1TMED.VV030 * 100.00 END AS CC_SERVICE_REVENUE,
  CASE WHEN TCURX.CURRDEC IS NULL THEN CE1TMED.KWFRGR ELSE CE1TMED.KWFRGR * 100.00 END AS CC_FREIGHT_REVENUE,
  CASE WHEN TCURX.CURRDEC IS NULL THEN CE1TMED.VVREB ELSE CE1TMED.VVREB * 100.00 END AS CC_REBATE_FEES,
  VBAK.ERDAT AS VBAK_ERDAT,
  VBAK.AUART AS VBAK_AUART,
 CASE WHEN VBAP."UMVKZ" IS NOT NULL THEN VBAP."PSTYV" ELSE '0' END AS VBAP_PSTYV,
  CASE WHEN VBAP."UMVKZ" IS NOT NULL THEN VBAP."VRKME" ELSE '0' END AS VBAP_VRKME,
  CASE WHEN VBAP."UMVKZ" IS NOT NULL THEN VBAP."MEINS" ELSE '0' END AS VBAP_MEINS,
  PERIO

FROM "ECC_NRT"."CE1TMED" AS CE1TMED
LEFT OUTER JOIN "ECC_RT"."MAKT" AS MAKT 
    ON CE1TMED.MATNR = MAKT.MATNR AND MAKT.SPRAS = 'E'
LEFT OUTER JOIN "ECC_NRT"."T001" AS T001 
    ON CE1TMED.BUKRS = T001.BUKRS AND T001.SPRAS = 'E'
LEFT OUTER JOIN "ECC_RT"."TCURX" AS TCURX 
    ON CE1TMED.REC_WAERS = TCURX.CURRKEY
LEFT OUTER JOIN "ECC_RT"."VBAK" AS VBAK 
    ON VBAK.VBELN = CE1TMED.KAUFN
LEFT OUTER JOIN "ECC_RT"."VBAP" AS VBAP 
    ON VBAP.VBELN = CE1TMED.KAUFN AND VBAP.POSNR = CE1TMED.KDPOS
WHERE CE1TMED.PERIO = '2022001';

END;
		
